{"version":3,"sources":["app/scripts.babel/background.js"],"names":[],"mappings":"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","file":"app/scripts.babel/background.js","sourcesContent":["'use strict';\n\nvar storage = {local:{}, sync: {}};\n\n// eslint hack\nvar _ = _;\n\nchrome.runtime.onInstalled.addListener(details => {\n\tconsole.log('previousVersion', details.previousVersion);\n\n\t// chrome.storage.sync.get('userid', function(items) {\n\t//     var userid = items.userid;\n\t//     if (userid) {\n\t//         useToken(userid);\n\t//     } else {\n\t//         userid = getRandomToken();\n\n\t//         chrome.storage.sync.set({userid: {}}, function() {\n\t//             useToken(userid);\n\t//         });\n\t//     }\n\t//     function useToken(userid) {\n\t//         // TODO: Use user id for authentication or whatever you want.\n\t//     }\n\t// });\n});\n\n/**\n * Create a random token to be used\n * @return {string} Random unique token\n */\nfunction getRandomToken() {\n\t// E.g. 8 * 32 = 256 bits token\n\tvar randomPool = new Uint8Array(32);\n\tcrypto.getRandomValues(randomPool);\n\tvar hex = '';\n\tfor (var i = 0; i < randomPool.length; ++i) {\n\t\thex += randomPool[i].toString(16);\n\t}\n\t// E.g. db18458e2782b2b77e36769c569e263a53885a9944dd0a861e5064eac16f1a\n\treturn hex;\n}\n\n/**\n * Pikcs a 'random' default nickname for this instance of chrome.\n * @return {string} Default Nickname\n */\nfunction getRandomNickname() {\n\tvar dict = ['Monkey', 'Cat', 'Dog', 'Horse', 'Rabbit', 'Squirrel', 'Owl', 'Deer', 'Hedgehog', 'Sheep', 'Fox'];\n\tvar index = Math.round(Math.random()*10);\n\treturn dict[index];\n}\n\nfunction newIdentity() {\n\tconst identity = { 'uid': getRandomToken(), 'nickname': getRandomNickname() };\n\tchrome.storage.local.set(identity);\n\n\tlet syncStore = {};\n\n\tsyncStore[identity.uid] = {'name': identity.nickname, tabs:{ inbound : []}};\n\tdebugger;\n\tchrome.storage.sync.set(syncStore);\n}\n\nchrome.storage.local.get(['uid', 'nickname'], (local) => {\n\tstorage.local = local;\n\n\tif(typeof storage.local.uid !== 'string') {\n\t\tnewIdentity();\n\t} else {\n\n\t}\n});\n\nfunction check() {\n\tchrome.storage.sync.get( storage.local.uid, function(storage) {\n\t\tvar urls = ( storage && storage.inbound ) ? storage.inbound : [];\n\t\topenTabs(urls);\n\t});\n}\n\n/**\n * Open many urls\n * @param  {Array} urls\n */\nfunction openTabs(urls) {\n\turls.map(openTab);\n}\n\n/**\n * Open single url\n * @param  {string} url\n */\nfunction openTab(url) {\n\tvar tabURL = {\n\t\turl: url\n\t};\n\tvar tab;\n\n\tif (typeof tab !== 'undefined' && (tab.url === '' || tab.url === 'chrome://newtab/' || tab.url === tabURL.url)) {\n\t\tchrome.tabs.update(null, tabURL);\n\t} else {\n\t\tchrome.tabs.create(tabURL);\n\t}\n}\n\nfunction removeInboundTabs() {\n\tchrome.storage.sync.get( storage.local.uid, function(store) {\n\t\tstore[ storage.local.uid ].tabs.inbound = [];\n\t\tchrome.storage.sync.set(store, () => {\n\n\t\t\tchrome.storage.sync.get(storage.local.uid, (store) => {\n\t\t\t\tconsole.log('cleared inbound');\n\t\t\t});\n\t\t});\n\t});\n}\n\nchrome.storage.onChanged.addListener((changes, areaName) => {\n\tconsole.log('change heard');\n\tchrome.storage.sync.get( storage.local.uid, function(store) {\n\t\tconst urls = _.pluck( store[storage.local.uid].tabs.inbound, 'url' );\n\t\topenTabs(urls);\n\t\tremoveInboundTabs();\n\t});\n});\n// openTab('http://twitter.com')\n// chrome.browserAction.setBadgeText({text: '\\'Allo'});\n\n// console.log('\\'Allo \\'Allo! Event Page for Browser Action');\n\n// var storageSample = {\n// \t123: {\n// \t\tname: 'Matrix',\n// \t\ttabs: {\n// \t\t\tinbound: [\n// \t\t\t\t{\n// \t\t\t\t\turl: 'http: //google.com'\n// \t\t\t\t}\n// \t\t\t],\n// \t\t\tsuspended: [\n// \t\t\t\t{\n// \t\t\t\t\turl: 'http: //maps.google.com'\n// \t\t\t\t}\n// \t\t\t]\n// \t\t}\n// \t},\n// \t234: {\n// \t\tname: 'Matrixy',\n// \t\ttabs: {\n// \t\t\tinbound: [\n// \t\t\t\t{\n// \t\t\t\t\turl: 'http: //google.com'\n// \t\t\t\t}\n// \t\t\t],\n// \t\t\tsuspended: [\n// \t\t\t\t{\n// \t\t\t\t\turl: 'http: //maps.google.com'\n// \t\t\t\t}\n// \t\t\t]\n// \t\t}\n// \t}\n// };\n\n// chrome.storage.sync.set(storageSample, () => {});\n\n// chrome.alarms.create({when: Date.now() + 2000});\n// chrome.alarms.onAlarm.addListener(check);\n// \n"]}