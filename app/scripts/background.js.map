{"version":3,"sources":["app/scripts.babel/background.js"],"names":[],"mappings":"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","file":"app/scripts.babel/background.js","sourcesContent":["'use strict';\n\n// eslint hack\nvar _ = _;\n\n/**\n * Create a random token to be used\n * @return {string} Random unique token\n */\nfunction getRandomToken() {\n\t// E.g. 8 * 32 = 256 bits token\n\tconst randomPool = new Uint8Array(32);\n\tcrypto.getRandomValues(randomPool);\n\tlet hex = '';\n\tfor (var i = 0; i < randomPool.length; ++i) {\n\t\thex += randomPool[i].toString(16);\n\t}\n\treturn hex;\n}\n\n/**\n * Pikcs a 'random' default nickname for this instance of chrome.\n * @return {string} Default Nickname\n */\nfunction getRandomNickname() {\n\tconst dict = ['Monkey', 'Cat', 'Dog', 'Horse', 'Rabbit', 'Squirrel', 'Owl', 'Deer', 'Hedgehog', 'Sheep', 'Fox'];\n\tconst index = Math.round(Math.random()*10);\n\treturn dict[index];\n}\n\n/**\n * Creates a new identity for this chrome instance.\n * @return {[type]} [description]\n */\nfunction newIdentity() {\n\tconst identity = { 'uid': getRandomToken() };\n\tchrome.storage.local.set(identity);\n\n\tlet syncStore = {};\n\tsyncStore[identity.uid] = {'name': identity.nickname, tabs:{ inbound : []}};\n\tchrome.storage.sync.set(syncStore);\n}\n\n/**\n * Open single url\n * @param  {string} url\n */\nfunction openTab(url) {\n\t// Split off anything after #\n\tvar tabURL = {\n\t\turl: url.split('#')[0]\n\t};\n\n\tchrome.tabs.query(tabURL, function (tabs) {\n\t\tif (tabs.length) {\n\t\t\tchrome.tabs.update(tabs[0].id, {selected: true});\n\t\t} else {\n\t\t\tchrome.tabs.create(tabURL);\n\t\t}\n\t});\n}\n\n/**\n * Open many urls\n * @param  {Array} urls\n */\nfunction openTabs(urls) {\n\turls.map(openTab);\n}\n\n// function check() {\n// \tchrome.storage.local.get(null, (local) => {\n// \t\tchrome.storage.sync.get( local.uid, function(storage) {\n// \t\t\tvar urls = ( storage && storage.inbound ) ? storage.inbound : [];\n// \t\t\topenTabs(urls);\n// \t\t});\n// \t});\n// }\n\nfunction removeInboundTabs() {\n\tchrome.storage.local.get(null, (local) => {\n\t\tchrome.storage.sync.get( local.uid, function(store) {\n\t\t\tstore[ local.uid ].tabs.inbound = [];\n\t\t\tchrome.storage.sync.set(store, () => {\n\t\t\t\t// Success\n\t\t\t});\n\t\t});\n\t});\n}\n\n/**\n * Listen for new inbound URLs\n */\nchrome.storage.onChanged.addListener((changes, areaName) => {\n\tchrome.storage.local.get(null, (local) => {\n\t\tconsole.log('change heard' + areaName);\n\t\tchrome.storage.sync.get( local.uid, function(store) {\n\t\t\tconst urls = _.pluck( store[local.uid].tabs.inbound, 'url' );\n\t\t\topenTabs(urls);\n\t\t\tremoveInboundTabs();\n\t\t});\n\t});\n});\n\n\nchrome.runtime.onInstalled.addListener(() => {\n\tchrome.storage.local.get(null, (local) => {\n\t\tif(typeof local.uid !== 'string') {\n\t\t\tnewIdentity();\n\t\t}\n\t\tif (typeof local.name !== 'string') {\n\t\t\tvar d =  { 'nickname': getRandomNickname() };\n\t\t\td=d;\n\t\t}\n\t});\n});"]}